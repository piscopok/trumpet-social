generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


model User {
    id        String   @id @default(cuid())
    email     String   @unique
    username  String   @unique
    clerkId   String   @unique
    name      String?
    bio       String?
    image     String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    posts Post[]
    comments Comment[]
    likes Like[]

    followers   Follower[] @relation("following") 
    following   Follower[] @relation("follower")

    notifications Notification[] @relation("userNotifications")
    notificationsCreated Notification[] @relation("notificationCreator")
}

model Post {
    id        String   @id @default(cuid())
    authorId  String
    content   String?
    image     String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    author User @relation(fields: [authorId], references: [id], onDelete: Cascade)
    comments Comment[]
    likes Like[]
    notifications Notification[]
}

model Comment {
    id        String   @id @default(cuid())
    authorId    String
    postId  String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    content   String

    post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
    author User @relation(fields: [authorId], references: [id], onDelete: Cascade)
    nortifications Notification[]

    @@index([authorId, postId])
}

model Like {
    id        String   @id @default(cuid())
    postId    String
    userId    String
    createdAt DateTime @default(now())

    post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId, postId])
    @@unique([userId, postId]) //same user cannot like the same post multiple times
}

model Follower {
    followerId  String
    followingId String
    createdAt   DateTime @default(now())

    follower User @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
    following User @relation("following", fields: [followingId], references: [id], onDelete: Cascade)

    @@index([followerId, followingId])
    @@id([followerId, followingId])
}

model Notification {
    id          String   @id @default(cuid())
    userId      String
    creatorId   String
    type        NotificationType
    read Boolean @default(false)
    postId      String?
    commentId   String?
    createdAt   DateTime @default(now())
    isRead      Boolean  @default(false)

    user User @relation("userNotifications", fields: [userId], references: [id], onDelete: Cascade)
    creator User @relation("notificationCreator", fields: [creatorId], references: [id], onDelete: Cascade)
    post Post? @relation(fields: [postId], references: [id], onDelete: Cascade)
    comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)

    @@index([userId, createdAt])
}

enum NotificationType {
    LIKE
    COMMENT
    FOLLOW
}